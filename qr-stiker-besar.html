<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>QR Stiker SIMPAN</title>

<style>
body{
  margin:0;
  padding:0;
  background:#eee;
  font-family:Arial, Helvetica, sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
}

.actions{
  margin:15px;
}
button{
  padding:8px 14px;
  margin:4px;
  border:none;
  background:#0a4ea3;
  color:#fff;
  font-weight:bold;
  border-radius:4px;
}

.sticker{
  width:8cm;
  height:10cm;
  background:#fff;
  border:3px solid #000;
  box-sizing:border-box;
  padding:10px;
  text-align:center;
}

.qr{
  width:200px;
  height:200px;
}

.id{
  font-weight:bold;
  margin-top:10px;
}
.info{
  font-size:14px;
  margin-top:2px;
}
.note{
  margin-top:8px;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="actions">
  <button>Download PNG</button>
  <button>Download JPG</button>
  <button>Download PDF</button>
</div>

<div class="sticker">
  <img id="qrImg" class="qr">
  <div id="idText" class="id"></div>
  <div id="namaText" class="info"></div>
  <div id="kapalText" class="info"></div>
  <div class="note">SCAN UNTUK VERIFIKASI</div>
</div>

<script>
const SHEET_JSON =
"https://docs.google.com/spreadsheets/d/1G8fNMGPKo3QX8rm85ux8u8SC0m3SpwKMtzXWShOscZQ/gviz/tq?tqx=out:json";

const idCari = new URLSearchParams(location.search).get("id");

const idEl    = document.getElementById("idText");
const namaEl  = document.getElementById("namaText");
const kapalEl = document.getElementById("kapalText");
const qrImg   = document.getElementById("qrImg");

idEl.innerText = idCari || "ID tidak ditemukan";

if(idCari){
  const targetURL =
    "https://simpandiperkan-ux.github.io/simpan/kapal.html?id=" +
    encodeURIComponent(idCari);

  qrImg.src =
    "https://api.qrserver.com/v1/create-qr-code/?size=500x500&data=" +
    encodeURIComponent(targetURL);

  fetch(SHEET_JSON)
    .then(r=>r.text())
    .then(t=>{
      const j=JSON.parse(t.substring(47,t.length-2));
      const h=j.table.cols.map(c=>c.label);
      const rows=j.table.rows.map(r=>r.c.map(c=>c?.v??""));

      const idxID=h.indexOf("ID SIMPAN");
      const idxNama=h.indexOf("Nama Lengkap");
      const idxKapal=h.indexOf("Nama Kapal");

      const row=rows.find(r=>String(r[idxID]).trim()===idCari);

      if(!row){
        namaEl.innerText="Data tidak ditemukan";
        return;
      }

      namaEl.innerText="Nama : "+(row[idxNama]||"-");
      kapalEl.innerText="Kapal : "+(row[idxKapal]||"-");
    });
}
</script>

</body>
</html>
