<script>
/* ===== PARAM ID ===== */
const params = new URLSearchParams(location.search);
const idCari = params.get("id");

if (!idCari) {
  document.body.innerHTML = "<h2>ID SIMPAN tidak ditemukan</h2>";
  throw "";
}

document.getElementById("idText").innerText = idCari;

/* ===== GOOGLE SHEET SOURCE (SAMA) ===== */
const SHEET_JSON =
"https://docs.google.com/spreadsheets/d/1G8fNMGPKo3QX8rm85ux8u8SC0m3SpwKMtzXWShOscZQ/gviz/tq?tqx=out:json";

/* ===== AMBIL DATA ===== */
fetch(SHEET_JSON)
  .then(r => r.text())
  .then(t => {
    const j = JSON.parse(t.substring(47, t.length - 2));
    const headers = j.table.cols.map(c => c.label);
    const rows = j.table.rows.map(r => r.c.map(c => c?.v ?? ""));

    const idxID    = headers.indexOf("ID SIMPAN");
    const idxNama  = headers.indexOf("Nama Lengkap");
    const idxKapal = headers.indexOf("Nama Kapal");

    const row = rows.find(r =>
      r[idxID]?.toString().trim() === idCari
    );

    if (!row) {
      document.getElementById("namaText").innerText = "Data tidak ditemukan";
      return;
    }

    document.getElementById("namaText").innerText =
      "Nama : " + row[idxNama];

    document.getElementById("kapalText").innerText =
      "Kapal : " + row[idxKapal];
  })
  .catch(err => {
    console.error(err);
    document.getElementById("namaText").innerText = "Gagal memuat data";
  });

/* ===== QR CODE ===== */
const targetURL =
  "https://simpandiperkan-ux.github.io/simpan/kapal.html?id=" +
  encodeURIComponent(idCari);

document.getElementById("qrImg").src =
  "https://api.qrserver.com/v1/create-qr-code/?size=1200x1200&margin=0&data=" +
  encodeURIComponent(targetURL);
</script>
