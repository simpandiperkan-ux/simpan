<script>
document.addEventListener("DOMContentLoaded", () => {

  const params = new URLSearchParams(location.search);
  const idCari = params.get("id");

  // ===== AMAN: TAMPILKAN ID DULU =====
  const idEl = document.getElementById("idText");
  const namaEl = document.getElementById("namaText");
  const kapalEl = document.getElementById("kapalText");
  const qrImg = document.getElementById("qrImg");

  if (!idCari) {
    idEl.innerText = "ID tidak ditemukan";
    return;
  }

  idEl.innerText = idCari;

  // ===== QR TETAP JALAN (APAPUN KONDISINYA) =====
  const targetURL =
    "https://simpandiperkan-ux.github.io/simpan/kapal.html?id=" +
    encodeURIComponent(idCari);

  qrImg.src =
    "https://api.qrserver.com/v1/create-qr-code/?size=1200x1200&margin=0&data=" +
    encodeURIComponent(targetURL);

  // ===== GOOGLE SHEET (SAMA DENGAN kapal.html) =====
  const SHEET_JSON =
    "https://docs.google.com/spreadsheets/d/1G8fNMGPKo3QX8rm85ux8u8SC0m3SpwKMtzXWShOscZQ/gviz/tq?tqx=out:json";

  fetch(SHEET_JSON)
    .then(r => r.text())
    .then(t => {
      const json = JSON.parse(t.substring(47, t.length - 2));
      const headers = json.table.cols.map(c => c.label);
      const rows = json.table.rows.map(r => r.c.map(c => c?.v ?? ""));

      const idxID = headers.indexOf("ID SIMPAN");
      const idxNama = headers.indexOf("Nama Lengkap");
      const idxKapal = headers.indexOf("Nama Kapal");

      if (idxID === -1) {
        namaEl.innerText = "Kolom ID SIMPAN tidak ditemukan";
        return;
      }

      const row = rows.find(r =>
        r[idxID]?.toString().trim() === idCari
      );

      if (!row) {
        namaEl.innerText = "Data tidak ditemukan";
        return;
      }

      namaEl.innerText = "Nama : " + (row[idxNama] || "-");
      kapalEl.innerText = "Kapal : " + (row[idxKapal] || "-");
    })
    .catch(err => {
      console.error("Sheet error:", err);
      namaEl.innerText = "Gagal memuat data";
    });

});
</script>
