<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Data Kapal SIMPAN</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ===============================
   TEMA RESMI PEMDA
================================ */
body{
  font-family: Arial, sans-serif;
  background: linear-gradient(120deg, #dbeafe, #f8fafc);
  padding:20px;
}

.box{
  max-width:900px;
  margin:auto;
  background:#fff;
  padding:28px;
  border-radius:16px;
  box-shadow:0 8px 30px rgba(0,0,0,.08);
}

/* ===============================
   HEADER
================================ */
.header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-bottom:20px;
  flex-wrap:wrap;
}

.logo-left img,
.logo-center img{
  height:70px;
  width:auto;
}

.logo-center{
  flex:1;
  text-align:center;
}

.title{
  text-align:center;
  margin-top:10px;
  font-size:22px;
  font-weight:bold;
  color:#0f172a;
}

/* ===============================
   TABLE
================================ */
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  padding:12px;
  border-bottom:1px solid #e5e7eb;
  text-align:left;
  vertical-align:top;
}
th{
  width:35%;
  background:#f1f5f9;
  font-weight:600;
  color:#1e293b;
}

img{
  max-width:160px;
  border-radius:8px;
}

a{color:#1a73e8;text-decoration:none}

.error{
  text-align:center;
  color:#b00020;
  font-weight:bold;
}

@media(max-width:600px){
  .header{flex-direction:column}
}
</style>
</head>

<body>

<div class="box">

  <!-- HEADER LOGO -->
  <div class="header">
    <div class="logo-left">
      <img src="logo-bateng.png" alt="Logo Kabupaten Bangka Tengah">
    </div>

    <div class="logo-center">
      <img src="logo-simpan.png" alt="Logo SIMPAN">
    </div>
  </div>

  <div class="title">Data Kapal SIMPAN</div>

  <div id="hasil">Memuat data...</div>
</div>

<script>
/* ===============================
   KONFIGURASI
================================ */
const SHEET_JSON =
"https://docs.google.com/spreadsheets/d/1G8fNMGPKo3QX8rm85ux8u8SC0m3SpwKMtzXWShOscZQ/gviz/tq?tqx=out:json";

/* ===============================
   KOLOM SENSITIF (DISEMBUNYIKAN)
================================ */
const HIDDEN_COLS = [
  "Nomor Induk Kependudukan (NIK)",
  "Upload Foto KTP Elektronik",
  "Nomor KUSUKA"
];

const hasil = document.getElementById("hasil");
const idCari = new URLSearchParams(location.search).get("id");

/* ===============================
   FORMAT NILAI
================================ */
function formatValue(label, val){
  if (!val) return "-";

  if (typeof val === "string" && val.startsWith("Date")) {
    const m = val.match(/\d+/g).map(Number);
    return new Date(m[0], m[1], m[2]).toLocaleDateString("id-ID");
  }

  if (typeof val === "string" && val.startsWith("http")) {
    return `<a href="${val}" target="_blank">Buka</a>`;
  }

  if (label.toLowerCase().includes("qr")) {
    return `<img src="${val}">`;
  }

  return val;
}

/* ===============================
   FETCH & RENDER
================================ */
fetch(SHEET_JSON)
  .then(r => r.text())
  .then(text => {
    const json = JSON.parse(text.substring(47, text.length - 2));
    const headers = json.table.cols.map(c => c.label);
    const rows = json.table.rows.map(r => r.c.map(c => c?.v ?? ""));

    const idIndex = headers.indexOf("ID SIMPAN");
    const row = rows.find(r => r[idIndex]?.toString().trim() === idCari);

    if (!row) {
      hasil.innerHTML = "<div class='error'>❌ Data tidak ditemukan</div>";
      return;
    }

    let html = "<table>";

    headers.forEach((h, i) => {
      if (HIDDEN_COLS.includes(h)) return;

      html += `
        <tr>
          <th>${h}</th>
          <td>${formatValue(h, row[i])}</td>
        </tr>
      `;
    });

    html += "</table>";
    hasil.innerHTML = html;
  })
  .catch(err => {
    console.error(err);
    hasil.innerHTML = "<div class='error'>❌ Gagal memuat data</div>";
  });
</script>

</body>
</html>
